<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Listenfy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style/global.css">
    <link rel="stylesheet" href="/style/dashboard.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="__content">
        <div class="__wrapper">
            <div class="main" id="main">
                <h1 class="main__title">Spotify Mood Report</h1>
                <div class="project__details">
                    <p><strong>Mood:</strong> <%= mood %></p>
                    <p><strong>Summary:</strong> <%= summary %></p>
                </div>

                <section class="section">
                    <h2 class="sub__title">Top Artists</h2>
                    <ul class="sub__list">
                        <% artists.forEach(a => { %>
                        <li class="artist__details">
                            <div>
                                <% if (a.image) { %>
                                <img src="<%= a.image %>" alt="<%= a.name %>" class="artist__image">
                                <% } %>
                            </div>
                            <div>
                                <p class="artist__name"><%= a.name %></p>
                                <p class="artist__followers"><%= a.followers.toLocaleString() %> followers</p>
                                <p class="artist__genres"><%= a.genres.join(', ') %></p>
                            </div>
                            <div>
                                <a href="<%= a.url %>" target="_blank" rel="noopener noreferrer">View on Spotify</a>
                            </div>
                        </li>
                        <% }); %>
                    </ul>
                </section>

                <section class="section">
                    <h2 class="sub__title">Top Genres</h2>
                    <ul class="sub__list">
                        <% genres.forEach(g => { %>
                        <li><%= g %></li>
                        <% }); %>
                    </ul>
                </section>


                <h2>Top Genres Canvas</h2>
                <canvas id="genreChart" width="400" height="400"></canvas>

                <script>
                    const ctx = document.getElementById('genreChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: <%= JSON.stringify(genres) %>,
                            datasets: [{
                            label: 'Top Genres',
                            data: <%- JSON.stringify(counts) %>,
                            backgroundColor: 'rgba(54, 162, 235, 0.6)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>



                <h2>Genre Distribution</h2>
                <canvas id="genrePie" width="400" height="400"></canvas>
                <script>
                const pieCtx = document.getElementById('genrePie').getContext('2d');
                new Chart(pieCtx, {
                    type: 'pie',
                    data: {
                    labels: <%- JSON.stringify(genres) %>,
                    datasets: [{
                        label: 'Genre Share',
                        data: <%- JSON.stringify(counts) %>,
                        backgroundColor: [
                        '#4dc9f6', '#f67019', '#f53794', '#537bc4', '#acc236',
                        '#166a8f', '#00a950', '#58595b', '#8549ba'
                        ]
                    }]
                    }
                });
                </script>
            </div>
        </div>
    </div>
</body>
</html>
